{% extends "base.html" %}
{% block title %}Дефекты{% endblock %}
{% block content %}
<style>
  .card-list { max-width:900px; margin:24px 24px 40px 48px; background:#fff; border-radius:16px; box-shadow:0 10px 20px rgba(0,0,0,0.08); }
  .row-item { display:flex; align-items:center; justify-content:space-between; padding:16px 20px; border-bottom:1px solid #f0f0f0; }
  .row-item:last-child { border-bottom:none; }
  .muted { color:#8a9096; }
  .create-pill { display:inline-flex; align-items:center; gap:8px; border:1px solid #ff8a2f; color:#ff8a2f; border-radius:999px; padding:6px 10px; font-size:13px; font-weight:600; text-decoration:none; }
  .create-pill:hover { background:#ff8a2f; color:#fff; }
  .button { background-color: transparent; color: #ff8a2f; height: 2.2em; border: 1px solid #ff8a2f; border-radius: 10px; transition: all 0.4s ease; display:inline-flex; align-items:center; gap:8px; padding: 0 0.9em; }
  .button:hover { background-color: #ff8a2f; cursor: pointer; color:#fff; border-radius: 8px; }
  .filters { display:flex; gap:12px; padding:12px 20px; border-bottom:1px solid #f0f0f0; }
  .filters input, .filters select { border:1px solid #ddd; border-radius:10px; padding:8px 10px; }
  .filters input:focus, .filters select:focus { outline:none; border-color: rgba(247,127,0,0.55); box-shadow:0 0 0 4px rgba(247,127,0,0.14); }
</style>
<div class="card-list">
  <div class="d-flex justify-content-between align-items-center" style="padding:16px 20px;">
    <h4 style="margin:0;">Дефекты</h4>
    {% if not user.is_observer %}
      <a class="create-pill" href="/defects/create/">Создать дефект</a>
    {% endif %}
  </div>
  <form method="get" class="filters">
    <input name="q" placeholder="Поиск" value="{{ request.GET.q }}">
    <select name="status">
      <option value="">Статус</option>
      <option value="new">новый</option>
      <option value="in_progress">в работе</option>
      <option value="review">на проверке</option>
      <option value="closed">закрыт</option>
      <option value="cancelled">отменён</option>
    </select>
    <select name="priority">
      <option value="">Приоритет</option>
      <option value="low">низкий</option>
      <option value="medium">средний</option>
      <option value="high">высокий</option>
    </select>
    <button class="button" type="submit">Фильтр</button>
  </form>
  {% for d in defects %}
    <div class="row-item">
      <div>
        <div><strong style="color:#ff8a2f;">{{ d.title }}</strong></div>
        <div class="muted">Проект: {{ d.project.title }} • Статус: {{ d.get_status_display }} • Приоритет: {{ d.get_priority_display }} • Срок: {{ d.deadline|default:"не задано" }}</div>
      </div>
      <a class="button" href="/defects/{{ d.id }}/">Открыть</a>
    </div>
  {% empty %}
    <div class="row-item"><span class="muted">Нет дефектов</span></div>
  {% endfor %}
</div>
{% endblock %}